---
import MainLayout from "../layouts/MainLayout.astro";
import { Image } from "astro:assets";
import tablenocloth from "../assets/images/tablenocloth.webp";
import finePlate from "../assets/images/finePlate.webp";
import mini from "../assets/images/mini.webp";
import cutlery from "../assets/images/cutlery.webp";
import smallcandle from "../assets/images/smallcandle.webp";
import bigcandle from "../assets/images/bigcandle.webp";
import karaffel from "../assets/images/karaffel.webp";
import plate from "../assets/images/plate.webp";
---

<MainLayout title="Set Your Table">
  <section class="text-center p-20">
    <h1 class="text-4xl font-bold mb-4">Set Your Table</h1>
    <p class="text-lg">
      Get inspiration to your next event or dinner hosting. Pick and place items
      on the table to set your dream table.
    </p>
  </section>

  <div class="flex items-center justify-center min-h-screen relative">
    <!-- STORT BILDE -->
    <div
      id="drop-area"
      class="relative w-[600px] h-[600px] bg-white overflow-hidden"
    >
      <Image
        src={tablenocloth}
        alt="Big image"
        class="w-full h-full object-cover"
      />
    </div>

    <!-- SMÃ… BILDER RUNDt -->
    <!-- 1 -->
    <div class="absolute top-[5%] left-1/2 -translate-x-1/2">
      <Image
        src={finePlate}
        alt="Draggable"
        class="w-26 h-26 draggable cursor-move"
      />
    </div>

    <!-- 2 -->
    <div class="absolute top-[15%] left-[20%]">
      <Image
        src={smallcandle}
        alt="Draggable"
        class="w-30 h-30 draggable cursor-move"
      />
    </div>

    <!-- 3 -->
    <div class="absolute top-[15%] right-[20%]">
      <Image
        src={mini}
        alt="Draggable"
        class="w-16 h-16 draggable cursor-move"
      />
    </div>

    <!-- 4 -->
    <div class="absolute top-1/2 left-[5%] -translate-y-1/2">
      <Image
        src={cutlery}
        alt="Draggable"
        class="w-30 h-30 draggable cursor-move"
      />
    </div>

    <!-- 5 -->
    <div class="absolute top-1/2 right-[5%] -translate-y-1/2">
      <Image
        src={plate}
        alt="Draggable"
        class="w-16 h-16 draggable cursor-move"
      />
    </div>

    <!-- 6 -->
    <div class="absolute bottom-[15%] left-[20%]">
      <Image
        src={bigcandle}
        alt="Draggable"
        class="w-36 h-36 draggable cursor-move"
      />
    </div>

    <!-- 7 -->
    <div class="absolute bottom-[5%] left-1/2 -translate-x-1/2">
      <Image
        src={karaffel}
        alt="Draggable"
        class="w-16 h-16 draggable cursor-move"
      />
    </div>
  </div>

  <script>
    const draggables = document.querySelectorAll(".draggable");
    const dropArea = document.getElementById("drop-area");

    draggables.forEach((img) => {
      img.addEventListener("mousedown", startDrag);
    });

    let currentImg = null;
    let offsetX = 0,
      offsetY = 0;

    function startDrag(e) {
      currentImg = e.target.cloneNode(true);
      document.body.appendChild(currentImg);
      currentImg.classList.add("absolute", "pointer-events-none");
      offsetX = e.offsetX;
      offsetY = e.offsetY;
      moveAt(e.pageX, e.pageY);

      document.addEventListener("mousemove", onMouseMove);
      document.addEventListener("mouseup", stopDrag);
    }

    function moveAt(pageX, pageY) {
      currentImg.style.left = pageX - offsetX + "px";
      currentImg.style.top = pageY - offsetY + "px";
    }

    function onMouseMove(e) {
      moveAt(e.pageX, e.pageY);
    }

    function stopDrag(e) {
      document.removeEventListener("mousemove", onMouseMove);
      document.removeEventListener("mouseup", stopDrag);

      const dropBounds = dropArea.getBoundingClientRect();
      if (
        e.pageX >= dropBounds.left &&
        e.pageX <= dropBounds.right &&
        e.pageY >= dropBounds.top &&
        e.pageY <= dropBounds.bottom
      ) {
        const newImg = currentImg.cloneNode(true);
        newImg.style.left = e.pageX - dropBounds.left - offsetX + "px";
        newImg.style.top = e.pageY - dropBounds.top - offsetY + "px";
        newImg.classList.remove("pointer-events-none");
        newImg.classList.add("absolute");
        dropArea.appendChild(newImg);
      }

      currentImg.remove();
      currentImg = null;
    }
  </script>
</MainLayout>
